<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Builders FirstSource | Safety Stand-Down</title>

<link rel="manifest" href="manifest.json"/>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  margin:0;
  background:#f4f6f8;
  color:#1F2A44;
}

header{
  background:#C8102E;
  color:#fff;
  padding:18px;
  text-align:center;
}

header h1{
  margin:0;
  font-size:20px;
  letter-spacing:.5px;
}

.container{
  max-width:900px;
  margin:auto;
  padding:20px;
}

.section{
  background:#fff;
  border:2px solid #C8102E;
  border-radius:10px;
  padding:18px;
  margin-bottom:20px;
  box-shadow:0 4px 10px rgba(0,0,0,0.05);
}

.section-title{
  font-size:18px;
  font-weight:700;
  margin-bottom:10px;
  color:#C8102E;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
}

label{
  font-weight:600;
  font-size:14px;
}

input, select, textarea{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}

textarea{
  resize:vertical;
}

button{
  width:100%;
  padding:14px;
  background:#C8102E;
  color:#fff;
  font-weight:700;
  border:none;
  border-radius:8px;
  margin-top:20px;
  cursor:pointer;
  font-size:16px;
}

button:hover{
  background:#a50e25;
}

.small{
  font-size:12px;
  color:#666;
  margin-top:8px;
}

img{
  border-radius:8px;
  margin-top:10px;
}
</style>
</head>

<body>

<header>
  <h1>Builders FirstSource</h1>
  <div>Safety Stand-Down</div>
</header>

<div class="container" id="pdfContent">

<!-- PROJECT INFO -->
<div class="section">
  <div class="section-title">Project Information</div>
  <div class="grid">
    <div>
      <label>Date</label>
      <input type="date">
    </div>
    <div>
      <label>BFS Representative</label>
      <input>
    </div>
    <div>
      <label>Customer</label>
      <input>
    </div>
    <div>
      <label>Project</label>
      <input id="jobsite">
    </div>
    <div>
      <label>Lot / Building</label>
      <input>
    </div>
    <div>
      <label>Workers Onsite</label>
      <input type="number">
    </div>
  </div>
</div>

<!-- SAFETY SUMMARY -->
<div class="section">
  <div class="section-title">Safety Summary</div>
  <label>PPE & Safety Procedures Followed?</label>
  <select>
    <option>Yes</option>
    <option>Partial</option>
    <option>No</option>
  </select>

  <label style="margin-top:15px;">Stand-Down Summary</label>
  <textarea rows="4"></textarea>

  <label style="margin-top:15px;">Project Issues</label>
  <textarea rows="4"></textarea>
</div>

<!-- PHOTOS -->
<div class="section">
  <div class="section-title">Photos</div>
  <input type="file" id="photoUpload" accept="image/*" multiple>
  <div class="small">Upload from gallery (multiple allowed)</div>
  <div id="photoPreview"></div>
</div>

<button id="savePdfBtn" type="button">
  Save Safety Stand Down (PDF)
</button>

</div>

<!-- PHOTO COMPRESSION -->
<script>
let compressedImages = [];

document.getElementById('photoUpload').addEventListener('change', function(event){
  const preview = document.getElementById('photoPreview');
  preview.innerHTML = '';
  compressedImages = [];

  Array.from(event.target.files).forEach(file=>{
    const reader = new FileReader();
    reader.onload = function(e){
      const img = new Image();
      img.src = e.target.result;

      img.onload = function(){
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        const MAX_WIDTH = 1000;
        const scale = MAX_WIDTH / img.width;

        canvas.width = MAX_WIDTH;
        canvas.height = img.height * scale;

        ctx.drawImage(img,0,0,canvas.width,canvas.height);

        const compressed = canvas.toDataURL("image/jpeg",0.6);
        compressedImages.push(compressed);

        const previewImg = document.createElement('img');
        previewImg.src = compressed;
        previewImg.style.width='100%';
        preview.appendChild(previewImg);
      };
    };
    reader.readAsDataURL(file);
  });
});
</script>

<!-- PDF GENERATION -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
document.getElementById("savePdfBtn").addEventListener("click", async ()=>{
  const { jsPDF } = window.jspdf;

  const btn = document.getElementById("savePdfBtn");
  btn.style.display="none";

  const element = document.getElementById("pdfContent");

  const canvas = await html2canvas(element,{
    scale:0.9,
    useCORS:true
  });

  btn.style.display="block";

  const imgData = canvas.toDataURL("image/jpeg",0.6);

  const pdf = new jsPDF("p","pt","a4");
  const pageWidth = pdf.internal.pageSize.getWidth();
  const imgWidth = pageWidth;
  const imgHeight = (canvas.height * imgWidth) / canvas.width;

  pdf.addImage(imgData,"JPEG",0,0,imgWidth,imgHeight,"","FAST");

  pdf.save("BFS_Safety_Stand_Down.pdf");
});
</script>

</body>
</html>

